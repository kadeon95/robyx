<!DOCTYPE html>
<html>
<p> </p>
<div>
zNear .01<input id="zNearSlider" type="range"
 min=".01" max="3" step="0.1" value="0.3" />
 3
</div>
<div>
zFar 3<input id="zFarSlider" type="range"
 min="3" max="10" step="3.0" value="3" />
 10
</div>
<div>
radius 0.05<input id="radiusSlider" type="range"
 min="0.05" max="10" step="0.1" value="7.0" />
 10
</div>
<div>
theta -90<input id="thetaSlider" type="range"
 min="-90" max="90" step="5" value="90" />
 90
</div>
<div>
phi -90<input id="phiSlider" type="range"
 min="-90" max="90" step="5" value="0" />
 90
</div>
<div>
fov 10<input id="fovSlider" type="range"
 min="10" max="120" step="5" value="45" />
 120
</div>
<div>
aspect 0.5<input id="aspectSlider" type="range"
 min="0.5" max="2" step="0.1" value="1" />
 2
</div>


<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

in vec4 aPosition;
in vec3 aNormal;
out vec3 N, Ldirectional, Lspotlight, E;
in vec2 aTexCoord;

out vec2 vTexCoord;
uniform vec4 uSpotlightPosition;
uniform vec4 uLightDirection;
uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;
uniform mat3 uNormalMatrix;

void main()
{
    
    vec3 pos = (uModelViewMatrix * aPosition).xyz;
    
    Lspotlight = normalize(uSpotlightPosition).xyz - normalize(pos);  // compute direction of spotlight center from this vertex. (l in the Phong Model)
    vTexCoord = aTexCoord;

    if(uLightDirection.z == 0.0)  Ldirectional = normalize(uLightDirection.xyz);  //Why z?
    else  Ldirectional = normalize(uLightDirection).xyz - normalize(pos);  // parameter that says direction of directional light source from this vertex (l in the Phong Model)

    //console.log("ciao");

    E =  -normalize(pos);
    N = normalize(uNormalMatrix*aNormal.xyz);
    gl_Position = uProjectionMatrix * uModelViewMatrix * aPosition;

}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es

precision mediump float;
in vec2 vTexCoord;

uniform vec4 uGlobalAmbientProduct;

uniform vec4 uDirectionalAmbientProduct;
uniform vec4 uDirectionalDiffuseProduct;
uniform vec4 uDirectionalSpecularProduct;

uniform vec4 uSpotlightAmbientProduct;
uniform vec4 uSpotlightDiffuseProduct;
uniform vec4 uSpotlightSpecularProduct;

uniform float uShininess;

in vec3 N, Ldirectional, E;

uniform vec4 u_Direction_spotlight; // direction of the spotlight. It's uniform because the direction of it is unique in scene.
uniform float u_limit;          // in dot space

in vec3 Lspotlight;
out vec4 fColor;
uniform sampler2D uTextureMap;

void main()
{

    //vec3 Hdirectional = normalize( Ldirectional + E );
    vec4 ambientDire = uDirectionalAmbientProduct;
    
    vec4 ambientGlob = uGlobalAmbientProduct;
    //vec3 Hspotlight = normalize( Lspotlight + E );
    vec4 ambientSpot = uSpotlightAmbientProduct;

    float KdDire = max( dot(normalize(Ldirectional), normalize(N)), 0.0 );    
    vec4  diffuseDire = KdDire*uDirectionalDiffuseProduct;   

    float KdSpot = max( dot(normalize(Lspotlight), normalize(N)), 0.0 );
    vec4  diffuseSpot = KdSpot*uSpotlightDiffuseProduct;
    //float KsDire = pow( max(dot(N, Hdirectional), 0.0), uShininess );
    //vec4  specularDire = KsDire * uDirectionalSpecularProduct;
    //float KsSpot = pow( max(dot(N, Hspotlight), 0.0), uShininess );
    //vec4  specularSpot = KsSpot * uSpotlightSpecularProduct;
    //if( dot(Ldirectional, N) < 0.0 ) specularDire = vec4(0.0, 0.0, 0.0, 1.0);
    //if( dot(Lspotlight, N) < 0.0 ) specularSpot = vec4(0.0, 0.0, 0.0, 1.0);

	vec4 Ci_directional= ambientGlob + ambientDire + diffuseDire;
	vec4 Ci_spotlight  = ambientSpot + diffuseSpot;
		
	vec4 Cs_directional= ambientGlob + ambientDire;
	vec4 Cs_spotlight  = ambientSpot;
		
	float treshold_spotlight  = max(dot(normalize(N), normalize(Lspotlight)), 0.0);
	float treshold_directional= max(dot(normalize(N), normalize(Ldirectional)), 0.0);
	
	vec4 spotlight_contrib  = Ci_spotlight;
	vec4 directional_contrib= Ci_directional;
	float light = 0.0;
	float specular = 0.0;

    // Spotlight contribute
	float dotFromDirectionOfSpotlight = dot( normalize(Lspotlight), -normalize(u_Direction_spotlight.xyz));
							   

	if(treshold_spotlight   <  0.5) 
		spotlight_contrib  = Cs_spotlight;
		
	if(treshold_directional < 0.5) 
		directional_contrib = Cs_directional;
	
	if (dotFromDirectionOfSpotlight >= u_limit) {
		fColor = spotlight_contrib + directional_contrib;

		//if (light > 0.0) {
		//	specular = pow(dot(N, halfVector), u_shininess);
		//}
	}else{
		fColor = directional_contrib;

	}
    //ambientDire + diffuseDire + ambientSpot + diffuseSpot ;
    
    fColor = fColor*texture(uTextureMap, vTexCoord);
    //fColor = ambientSpot + diffuseSpot +specularSpot;
    fColor.a = 1.0;

}
</script>

<script type="text/javascript" src="InitShaders.js"></script>
<script type="text/javascript" src="MVnew.js"></script>
<script type="text/javascript" src="hw1.js"></script>

<body>
<canvas id="gl-canvas" width="512" height="512">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
<div>
directional lightX -2<input id="lightDirectionX" type="range"
 min="-2" max="2" step="0.1" value="1" />
 2
</div>
<div>
directional lightY -2<input id="lightDirectionY" type="range"
 min="-2" max="2" step="0.1" value="1" />
 2
</div>
<div>
directional lightZ -2<input id="lightDirectionZ" type="range"
 min="-2" max="2" step="0.1" value="1" />
 2
</div>
<div>
spotlightX -2<input id="spotlightPositionX" type="range"
 min="-2" max="2" step="0.1" value="1" />
 2
</div>
<div>
spotlightY -2<input id="spotlightPositionY" type="range"
 min="-2" max="2" step="0.1" value="1" />
 2
</div>
<div>
spotlightZ -2<input id="spotlightPositionZ" type="range"
 min="-2" max="2" step="0.1" value="1" />
 2
</div>
<div>
spotlightDirectionX -2<input id="spotlightDirectionX" type="range"
 min="-2" max="2" step="0.01" value="0" />
 2
</div>
<div>
spotlightDirectionY -2<input id="spotlightDirectionY" type="range"
 min="-2" max="2" step="0.01" value="0" />
 2
</div>
<div>
spotlightDirectionZ -2<input id="spotlightDirectionZ" type="range"
 min="-2" max="2" step="0.01" value="-0.23" />
 2
</div>
<div>
spotlightLimit -3.14<input id="spotlightLimit" type="range"
 min="-3.14" max="3.14" step="0.01" value="0.5" />
+3.14
</div>
<img id = "texImage" src = "texture_chioma.jpeg" crossorigin = "anonymous" hidden></img>

</body>
</html>
